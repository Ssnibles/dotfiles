# Environment and D-Bus setup
env = XDG_CURRENT_DESKTOP,Hyprland
env = XDG_SESSION_DESKTOP,Hyprland
env = GDK_BACKEND,wayland,x11
env = QT_QPA_PLATFORM,wayland;xcb
env = SDL_VIDEODRIVER,wayland
env = CLUTTER_BACKEND,wayland
env = MOZ_ENABLE_WAYLAND,1

# D-Bus and screen sharing setup (combined and moved to the top for early initialization)
exec-once = dbus-update-activation-environment --systemd WAYLAND_DISPLAY XDG_CURRENT_DESKTOP
exec-once = systemctl --user import-environment WAYLAND_DISPLAY XDG_CURRENT_DESKTOP

# Background management
exec-once = swww init
exec-once = swww img ~/.config/hypr/wallpapers/field_at_sundown.jpg --outputs HDMI-A-1 --resize fit
exec-once = swww img ~/.config/hypr/wallpapers/field_at_sundown.jpg --outputs DP-1 --resize crop

# Idle management (uncommented for better power management)
exec-once = swayidle -w timeout 300 'swaylock -f' timeout 600 'hyprctl dispatch dpms off' resume 'hyprctl dispatch dpms on' before-sleep 'swaylock -f'

# Status bar and notifications
exec-once = ~/.config/hypr/scripts/waybar_reload.sh
exec-once = mako

# Input method
exec-once = fcitx5 -d

# Network management (consider using iwd or NetworkManager without applet for better Wayland compatibility)
exec-once = nm-applet --indicator

# Audio volume overlay
exec-once = bash -c "mkfifo /tmp/wob.$(id -u) && tail -f /tmp/wob.$(id -u) | wob"

# Authentication agent
exec-once = /usr/lib/polkit-kde-authentication-agent-1

# Clipboard manager
exec-once = wl-paste --type text --watch cliphist store
exec-once = wl-paste --type image --watch cliphist store
exec-once = wl-clip-persist --clipboard both

# Automatic screen temperature adjustment
exec-once = gammastep -m wayland

# Bluetooth management (uncommented for functionality)
exec-once = blueman-applet

# Automatic mounting of removable media
exec-once = udiskie

# GSConnect/KDE Connect
exec-once = /usr/lib/kdeconnectd

# Start XDG autostart .desktop files
exec-once = dex -a -s /etc/xdg/autostart/:~/.config/autostart/

# Set GTK theme (uncommented and using popular themes as examples)
exec-once = gsettings set org.gnome.desktop.interface gtk-theme 'Adwaita-dark'
exec-once = gsettings set org.gnome.desktop.interface icon-theme 'Papirus-Dark'
exec-once = gsettings set org.gnome.desktop.interface cursor-theme 'Adwaita'

# Disable middle-click paste
exec-once = wl-paste -p --watch wl-copy -p ''

# Add XDG portal for better app integration
exec-once = /usr/libexec/xdg-desktop-portal-hyprland

# Add key binding daemon for advanced keyboard shortcuts
exec-once = swhkd -c ~/.config/hypr/swhkd/swhkdrc

# Add low battery notification
exec-once = ~/.config/hypr/scripts/battery-low-notify.sh

# Add automatic display configuration
exec-once = kanshi

# Add screen locker
exec-once = swaylock -i ~/.config/hypr/wallpapers/lock_screen.jpg
